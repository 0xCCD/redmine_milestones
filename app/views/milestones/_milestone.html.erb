<div id="milestone_#{milestone.id}" class="milestone">
  <%= image_tag('flag_red.png', :plugin=>'redmine_milestones', :style=>'vertical-align: top') %>
  <div style="display: inline-block">
    <strong>
      <%= link_to milestone.composite_description, milestone_path(milestone) %>
    </strong>
    <br>
    <%=  milestone.description %>
  </div>
  <% unless milestone.issues.empty? %>
      <% form_tag({}) do -%>
          <table class="list related-issues">
            <caption><%= l(:label_related_issues) %></caption>
            <% milestone.issues.visible.each do |issue| -%>
                <tr class="hascontextmenu">
                  <td class="checkbox"><%= check_box_tag 'ids[]', issue.id, false, :id => nil %></td>
                  <td><%= link_to_issue(issue, :project => (@project != issue.project)) %></td>
                </tr>
            <% end -%>
          </table>
      <% end %>
  <% end %>
  <% visited_milestones ||= Set.new %>
  <% visited_milestones << milestone.id %>
  <% unless milestone.children.empty? %>
    <% if params[:completed_milestones] %>
      <%= render :partial => "milestones/milestone", :collection => milestone.children.reject{|x| visited_milestones.include? x.id}, :locals => {:visited_milestones => visited_milestones} %>
    <% else %>
      <%= render :partial => "milestones/milestone", :collection => milestone.children.opened.reject{|x| visited_milestones.include? x.id}, :locals => {:visited_milestones => visited_milestones} %>
    <% end %>
  <% end %>
</div>
